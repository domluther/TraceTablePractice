<!DOCTYPE html>
<html>
<head>
    <title>Path Tracing Test</title>
</head>
<body>
    <h2>Tracing Execution Path</h2>
    <div id="results"></div>

    <script type="module">
        import { Interpreter } from './js/interpreter.js';

        const interpreter = new Interpreter();
        const results = document.getElementById('results');

        function log(message) {
            console.log(message);
            const div = document.createElement('div');
            div.textContent = message;
            div.style.margin = '5px 0';
            div.style.fontFamily = 'monospace';
            results.appendChild(div);
        }

        // Test the exact failing scenario with path tracing
        const testVars = { country: "France", x: 1 };
        const testLine = 'print(country.substring(x, 1))';
        
        log(`Testing: ${testLine}`);
        log(`Variables: ${JSON.stringify(testVars)}`);
        
        // Extract the content manually like the interpreter does
        const content = testLine.substring(6, testLine.length - 1);
        log(`Content: "${content}"`);
        
        // Test each condition in order
        log(`\n=== Condition Checks ===`);
        
        // 1. String literal check
        const isStringLiteral = content.startsWith('"') && content.endsWith('"');
        log(`1. String literal? ${isStringLiteral}`);
        
        // 2. Comma-separated check
        const hasComma = content.includes(',');
        log(`2. Has comma? ${hasComma}`);
        
        // 3. Substring check
        const hasSubstring = content.includes('.substring(');
        log(`3. Has substring? ${hasSubstring}`);
        
        if (hasSubstring) {
            const match = content.match(/(\w+)\.substring\(([^,]+),\s*([^)]+)\)/);
            log(`   Regex match? ${match ? 'YES' : 'NO'}`);
            
            if (match) {
                const varExists = testVars[match[1]] !== undefined;
                log(`   Variable ${match[1]} exists? ${varExists}`);
                
                if (varExists) {
                    log(`   ✅ Should execute substring logic`);
                } else {
                    log(`   ❌ Variable doesn't exist - won't execute`);
                }
            } else {
                log(`   ❌ Regex doesn't match - won't execute`);
            }
        }
        
        // 4. Other string methods
        const hasOtherMethods = content.includes('.left(') || content.includes('.right(') || 
                               content.includes('.upper') || content.includes('.lower') || 
                               content.includes('.length');
        log(`4. Other string methods? ${hasOtherMethods}`);
        
        // 5. String concatenation
        const hasPlus = content.includes('+');
        log(`5. Has plus (concatenation)? ${hasPlus}`);
        
        // 6. Arithmetic expression
        const isArithmetic = interpreter.isArithmeticExpression(content);
        log(`6. Is arithmetic expression? ${isArithmetic}`);
        
        // 7. Variable reference
        const isVariable = testVars[content] !== undefined;
        log(`7. Is variable reference? ${isVariable}`);
        
        // Now test the actual executeStatement
        log(`\n=== Actual executeStatement ===`);
        try {
            const result = interpreter.executeStatement(testLine, 999, testVars);
            log(`Result output: "${result.output}"`);
            log(`Output type: ${typeof result.output}`);
        } catch (e) {
            log(`Error: ${e.message}`);
        }
    </script>
</body>
</html>
