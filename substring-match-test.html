<!DOCTYPE html>
<html>
<head>
    <title>Substring Match Test</title>
</head>
<body>
    <h2>Testing Substring Matching</h2>
    <div id="results"></div>

    <script type="module">
        import { Interpreter } from './js/interpreter.js';

        const interpreter = new Interpreter();
        const results = document.getElementById('results');

        function log(message) {
            console.log(message);
            const div = document.createElement('div');
            div.textContent = message;
            div.style.margin = '5px 0';
            div.style.fontFamily = 'monospace';
            results.appendChild(div);
        }

        // Test the exact content that would be in a print statement
        const testContent = "country.substring(x, 1)";
        log(`Testing content: "${testContent}"`);
        
        // Test all the condition checks
        log(`includes(',')? ${testContent.includes(',')}`);
        log(`includes('.substring(')? ${testContent.includes('.substring(')}`);
        log(`includes('.left(')? ${testContent.includes('.left(')}`);
        log(`includes('+')? ${testContent.includes('+')}`);
        
        // Test the isArithmeticExpression check
        log(`isArithmeticExpression? ${interpreter.isArithmeticExpression(testContent)}`);
        
        // Test the regex match
        const match = testContent.match(/(\w+)\.substring\(([^,]+),\s*([^)]+)\)/);
        log(`Regex match: ${match ? 'YES' : 'NO'}`);
        if (match) {
            log(`  Variable: ${match[1]}`);
            log(`  Start param: ${match[2]}`);
            log(`  Length param: ${match[3]}`);
        }
        
        // Test with actual variables
        const testVars = { country: "France", x: 1 };
        log(`\nWith variables: ${JSON.stringify(testVars)}`);
        
        if (match && testVars[match[1]] !== undefined) {
            log(`Variable ${match[1]} exists: "${testVars[match[1]]}"`);
            
            const startParam = match[2].trim();
            const lengthParam = match[3].trim();
            
            let start;
            if (testVars[startParam] !== undefined) {
                start = parseInt(testVars[startParam]);
                log(`Start from variable ${startParam}: ${start}`);
            } else if (!isNaN(startParam)) {
                start = parseInt(startParam);
                log(`Start from literal: ${start}`);
            } else {
                start = 0;
                log(`Start fallback: ${start}`);
            }
            
            let length;
            if (testVars[lengthParam] !== undefined) {
                length = parseInt(testVars[lengthParam]);
                log(`Length from variable: ${length}`);
            } else if (!isNaN(lengthParam)) {
                length = parseInt(lengthParam);
                log(`Length from literal: ${length}`);
            } else {
                length = 1;
                log(`Length fallback: ${length}`);
            }
            
            const result = testVars[match[1]].toString().substring(start, start + length);
            log(`Final result: "${result}"`);
        }
    </script>
</body>
</html>
